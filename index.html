<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>30-Year Financial Planner</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f9fafb;
            color: #111827;
            line-height: 1.5;
        }
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 1rem;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .grid {
            display: grid;
            gap: 1rem;
        }
        @media (min-width: 768px) {
            .grid-2 { grid-template-columns: repeat(2, 1fr); }
            .grid-3 { grid-template-columns: repeat(3, 1fr); }
            .grid-4 { grid-template-columns: repeat(4, 1fr); }
        }
        .summary-card {
            padding: 1.5rem;
            border-radius: 8px;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .bg-blue { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .bg-green { background: linear-gradient(135deg, #10b981, #059669); }
        .bg-purple { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .bg-orange { background: linear-gradient(135deg, #f97316, #ea580c); }
        .input-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 1rem;
        }
        input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            overflow-x: auto;
            margin-bottom: 1.5rem;
        }
        .tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            white-space: nowrap;
        }
        .tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        h1 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .subtitle {
            color: #6b7280;
            margin-bottom: 1rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        th {
            background: #f9fafb;
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 500;
            color: #6b7280;
            text-transform: uppercase;
            font-size: 0.75rem;
        }
        td {
            padding: 0.5rem 1rem;
            border-top: 1px solid #e5e7eb;
        }
        .table-container {
            overflow-x: auto;
            margin-top: 1.5rem;
        }
        .highlight-row {
            background-color: #fef3c7;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            margin-right: 0.5rem;
        }
        .help-text {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        .footer {
            text-align: center;
            font-size: 0.875rem;
            color: #6b7280;
            padding: 1rem;
        }
        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 0.25rem;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        .modal {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .modal-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background: #2563eb;
        }
        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }
        .btn-secondary:hover {
            background: #d1d5db;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn-danger:hover {
            background: #dc2626;
        }
        .scenario-item {
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .scenario-info h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .scenario-info p {
            font-size: 0.75rem;
            color: #6b7280;
        }
        .scenario-actions {
            display: flex;
            gap: 0.5rem;
        }
        .toolbar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Area, AreaChart } = Recharts;

        function FinancialPlanner() {
            const [inputs, setInputs] = useState({
                currentAge: 30,
                retirementAge: 65,
                initialSalary: 75000,
                salaryGrowthRate: 3,
                bonusIncome: 0,
                otherIncome: 0,
                taxRate: 25,
                annualExpenses: 45000,
                expenseInflation: 2.5,
                currentSavings: 20000,
                savingsRate: 20,
                equityAllocation: 70,
                equityReturn: 8,
                propertyReturn: 5,
                hasProperty: false,
                propertyValue: 300000,
                mortgageBalance: 240000,
                mortgageRate: 4,
                mortgageYears: 25,
                propertyAppreciation: 3,
                rentalIncome: 0,
                propertyExpenses: 5000,
                retirementIncome: 0,
                retirementExpenseMultiplier: 80,
            });

            const [activeTab, setActiveTab] = useState('inputs');
            const [savedScenarios, setSavedScenarios] = useState(() => {
                const saved = localStorage.getItem('financialScenarios');
                return saved ? JSON.parse(saved) : [];
            });
            const [showSaveModal, setShowSaveModal] = useState(false);
            const [showLoadModal, setShowLoadModal] = useState(false);
            const [scenarioName, setScenarioName] = useState('');
            const [selectedComparisons, setSelectedComparisons] = useState([]);

            const updateInput = (key, value) => {
                setInputs(prev => ({ ...prev, [key]: parseFloat(value) || 0 }));
            };

            const saveScenario = () => {
                if (!scenarioName.trim()) {
                    alert('Please enter a scenario name');
                    return;
                }
                
                const newScenario = {
                    id: Date.now(),
                    name: scenarioName,
                    inputs: { ...inputs },
                    savedAt: new Date().toISOString()
                };
                
                const updated = [...savedScenarios, newScenario];
                setSavedScenarios(updated);
                localStorage.setItem('financialScenarios', JSON.stringify(updated));
                setScenarioName('');
                setShowSaveModal(false);
            };

            const loadScenario = (scenario) => {
                setInputs(scenario.inputs);
                setShowLoadModal(false);
            };

            const deleteScenario = (id) => {
                if (confirm('Are you sure you want to delete this scenario?')) {
                    const updated = savedScenarios.filter(s => s.id !== id);
                    setSavedScenarios(updated);
                    localStorage.setItem('financialScenarios', JSON.stringify(updated));
                }
            };

            const calculateProjectionsForInputs = (scenarioInputs) => {
                const years = [];
                const currentYear = new Date().getFullYear();
                
                let equityBalance = scenarioInputs.currentSavings * (scenarioInputs.equityAllocation / 100);
                let propertyInvestment = scenarioInputs.currentSavings * (1 - scenarioInputs.equityAllocation / 100);
                let propertyValue = scenarioInputs.hasProperty ? scenarioInputs.propertyValue : 0;
                let mortgageBalance = scenarioInputs.hasProperty ? scenarioInputs.mortgageBalance : 0;
                let annualExpenses = scenarioInputs.annualExpenses;
                let salary = scenarioInputs.initialSalary;
                
                const monthlyRate = scenarioInputs.hasProperty ? scenarioInputs.mortgageRate / 100 / 12 : 0;
                const numPayments = scenarioInputs.hasProperty ? scenarioInputs.mortgageYears * 12 : 0;
                const monthlyPayment = scenarioInputs.hasProperty && mortgageBalance > 0
                    ? mortgageBalance * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1)
                    : 0;
                const annualMortgagePayment = monthlyPayment * 12;

                for (let i = 0; i <= 30; i++) {
                    const age = scenarioInputs.currentAge + i;
                    const isRetired = age >= scenarioInputs.retirementAge;
                    
                    let grossIncome = isRetired ? scenarioInputs.retirementIncome : salary;
                    grossIncome += scenarioInputs.bonusIncome + scenarioInputs.otherIncome;
                    if (scenarioInputs.hasProperty) {
                        grossIncome += scenarioInputs.rentalIncome;
                    }
                    
                    const tax = grossIncome * (scenarioInputs.taxRate / 100);
                    const afterTaxIncome = grossIncome - tax;
                    
                    if (isRetired && i === scenarioInputs.retirementAge - scenarioInputs.currentAge) {
                        annualExpenses = annualExpenses * (scenarioInputs.retirementExpenseMultiplier / 100);
                    }
                    const propertyExpenses = scenarioInputs.hasProperty ? scenarioInputs.propertyExpenses : 0;
                    const totalExpenses = annualExpenses + propertyExpenses + (mortgageBalance > 0 ? annualMortgagePayment : 0);
                    
                    const availableForSavings = afterTaxIncome - totalExpenses;
                    const actualSavings = Math.max(0, availableForSavings * (scenarioInputs.savingsRate / 100));
                    
                    const equityContribution = actualSavings * (scenarioInputs.equityAllocation / 100);
                    const propertyContribution = actualSavings * (1 - scenarioInputs.equityAllocation / 100);
                    
                    equityBalance = equityBalance * (1 + scenarioInputs.equityReturn / 100) + equityContribution;
                    propertyInvestment = propertyInvestment * (1 + scenarioInputs.propertyReturn / 100) + propertyContribution;
                    
                    if (scenarioInputs.hasProperty) {
                        propertyValue = propertyValue * (1 + scenarioInputs.propertyAppreciation / 100);
                        
                        if (mortgageBalance > 0) {
                            const interestPayment = mortgageBalance * (scenarioInputs.mortgageRate / 100);
                            const principalPayment = Math.min(annualMortgagePayment - interestPayment, mortgageBalance);
                            mortgageBalance = Math.max(0, mortgageBalance - principalPayment);
                        }
                    }
                    
                    const propertyEquity = scenarioInputs.hasProperty ? propertyValue - mortgageBalance : 0;
                    const netWorth = equityBalance + propertyInvestment + propertyEquity;
                    
                    years.push({
                        year: currentYear + i,
                        age,
                        netWorth: Math.round(netWorth),
                    });
                    
                    if (!isRetired) {
                        salary = salary * (1 + scenarioInputs.salaryGrowthRate / 100);
                    }
                    annualExpenses = annualExpenses * (1 + scenarioInputs.expenseInflation / 100);
                }
                
                return years;
            };

            const toggleComparison = (scenarioId) => {
                setSelectedComparisons(prev => {
                    if (prev.includes(scenarioId)) {
                        return prev.filter(id => id !== scenarioId);
                    } else {
                        return [...prev, scenarioId];
                    }
                });
            };

            const comparisonData = useMemo(() => {
                if (selectedComparisons.length === 0) return [];
                
                const currentYear = new Date().getFullYear();
                const years = Array.from({ length: 31 }, (_, i) => ({ year: currentYear + i }));
                
                // Add current scenario
                const currentProjections = projections;
                years.forEach((yearData, i) => {
                    yearData['Current'] = currentProjections[i]?.netWorth || 0;
                });
                
                // Add selected scenarios
                selectedComparisons.forEach(scenarioId => {
                    const scenario = savedScenarios.find(s => s.id === scenarioId);
                    if (scenario) {
                        const scenarioProjections = calculateProjectionsForInputs(scenario.inputs);
                        years.forEach((yearData, i) => {
                            yearData[scenario.name] = scenarioProjections[i]?.netWorth || 0;
                        });
                    }
                });
                
                return years;
            }, [selectedComparisons, savedScenarios, projections]);

            const comparisonColors = ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ef4444', '#06b6d4'];
            const getComparisonLines = () => {
                const lines = [
                    <Line key="current" type="monotone" dataKey="Current" stroke={comparisonColors[0]} strokeWidth={3} name="Current" />
                ];
                
                selectedComparisons.forEach((scenarioId, index) => {
                    const scenario = savedScenarios.find(s => s.id === scenarioId);
                    if (scenario) {
                        lines.push(
                            <Line 
                                key={scenarioId} 
                                type="monotone" 
                                dataKey={scenario.name} 
                                stroke={comparisonColors[(index + 1) % comparisonColors.length]} 
                                strokeWidth={2} 
                                name={scenario.name}
                            />
                        );
                    }
                });
                
                return lines;
            };

            const projections = useMemo(() => {
                const years = [];
                const currentYear = new Date().getFullYear();
                
                let equityBalance = inputs.currentSavings * (inputs.equityAllocation / 100);
                let propertyInvestment = inputs.currentSavings * (1 - inputs.equityAllocation / 100);
                let propertyValue = inputs.hasProperty ? inputs.propertyValue : 0;
                let mortgageBalance = inputs.hasProperty ? inputs.mortgageBalance : 0;
                let annualExpenses = inputs.annualExpenses;
                let salary = inputs.initialSalary;
                
                const monthlyRate = inputs.hasProperty ? inputs.mortgageRate / 100 / 12 : 0;
                const numPayments = inputs.hasProperty ? inputs.mortgageYears * 12 : 0;
                const monthlyPayment = inputs.hasProperty && mortgageBalance > 0
                    ? mortgageBalance * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1)
                    : 0;
                const annualMortgagePayment = monthlyPayment * 12;

                for (let i = 0; i <= 30; i++) {
                    const age = inputs.currentAge + i;
                    const isRetired = age >= inputs.retirementAge;
                    
                    let grossIncome = isRetired ? inputs.retirementIncome : salary;
                    grossIncome += inputs.bonusIncome + inputs.otherIncome;
                    if (inputs.hasProperty) {
                        grossIncome += inputs.rentalIncome;
                    }
                    
                    const tax = grossIncome * (inputs.taxRate / 100);
                    const afterTaxIncome = grossIncome - tax;
                    
                    if (isRetired && i === inputs.retirementAge - inputs.currentAge) {
                        annualExpenses = annualExpenses * (inputs.retirementExpenseMultiplier / 100);
                    }
                    const propertyExpenses = inputs.hasProperty ? inputs.propertyExpenses : 0;
                    const totalExpenses = annualExpenses + propertyExpenses + (mortgageBalance > 0 ? annualMortgagePayment : 0);
                    
                    const availableForSavings = afterTaxIncome - totalExpenses;
                    const actualSavings = Math.max(0, availableForSavings * (inputs.savingsRate / 100));
                    
                    const equityContribution = actualSavings * (inputs.equityAllocation / 100);
                    const propertyContribution = actualSavings * (1 - inputs.equityAllocation / 100);
                    
                    equityBalance = equityBalance * (1 + inputs.equityReturn / 100) + equityContribution;
                    propertyInvestment = propertyInvestment * (1 + inputs.propertyReturn / 100) + propertyContribution;
                    
                    if (inputs.hasProperty) {
                        propertyValue = propertyValue * (1 + inputs.propertyAppreciation / 100);
                        
                        if (mortgageBalance > 0) {
                            const interestPayment = mortgageBalance * (inputs.mortgageRate / 100);
                            const principalPayment = Math.min(annualMortgagePayment - interestPayment, mortgageBalance);
                            mortgageBalance = Math.max(0, mortgageBalance - principalPayment);
                        }
                    }
                    
                    const propertyEquity = inputs.hasProperty ? propertyValue - mortgageBalance : 0;
                    const netWorth = equityBalance + propertyInvestment + propertyEquity;
                    
                    years.push({
                        year: currentYear + i,
                        age,
                        grossIncome: Math.round(grossIncome),
                        tax: Math.round(tax),
                        afterTaxIncome: Math.round(afterTaxIncome),
                        expenses: Math.round(totalExpenses),
                        savings: Math.round(actualSavings),
                        equityBalance: Math.round(equityBalance),
                        propertyInvestment: Math.round(propertyInvestment),
                        propertyValue: Math.round(propertyValue),
                        propertyEquity: Math.round(propertyEquity),
                        mortgageBalance: Math.round(mortgageBalance),
                        netWorth: Math.round(netWorth),
                        cashFlow: Math.round(afterTaxIncome - totalExpenses),
                    });
                    
                    if (!isRetired) {
                        salary = salary * (1 + inputs.salaryGrowthRate / 100);
                    }
                    annualExpenses = annualExpenses * (1 + inputs.expenseInflation / 100);
                }
                
                return years;
            }, [inputs]);

            const formatCurrency = (value) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0,
                }).format(value);
            };

            const CustomTooltip = ({ active, payload }) => {
                if (active && payload && payload.length) {
                    return (
                        <div style={{
                            background: 'white',
                            padding: '1rem',
                            border: '1px solid #d1d5db',
                            borderRadius: '6px',
                            boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
                        }}>
                            <p style={{ fontWeight: 600, marginBottom: '0.5rem' }}>
                                {`Year ${payload[0].payload.year} (Age ${payload[0].payload.age})`}
                            </p>
                            {payload.map((entry, index) => (
                                <p key={index} style={{ color: entry.color, fontSize: '0.875rem' }}>
                                    {`${entry.name}: ${formatCurrency(entry.value)}`}
                                </p>
                            ))}
                        </div>
                    );
                }
                return null;
            };

            const finalProjection = projections[projections.length - 1];
            const retirementProjection = projections[Math.min(inputs.retirementAge - inputs.currentAge, 30)] || finalProjection;

            return (
                <div className="container">
                    <div className="card">
                        <h1>30-Year Financial Planner</h1>
                        <p className="subtitle">Model your financial future with income, tax, expense, and investment projections</p>
                    </div>

                    <div className="grid grid-4">
                        <div className="summary-card bg-blue">
                            <div className="stat-label">Current Net Worth</div>
                            <div className="stat-value">{formatCurrency(projections[0].netWorth)}</div>
                        </div>
                        <div className="summary-card bg-green">
                            <div className="stat-label">Projected (30yr)</div>
                            <div className="stat-value">{formatCurrency(finalProjection.netWorth)}</div>
                        </div>
                        <div className="summary-card bg-purple">
                            <div className="stat-label">At Age {inputs.retirementAge}</div>
                            <div className="stat-value">{formatCurrency(retirementProjection.netWorth)}</div>
                        </div>
                        <div className="summary-card bg-orange">
                            <div className="stat-label">Total Growth</div>
                            <div className="stat-value">{formatCurrency(finalProjection.netWorth - projections[0].netWorth)}</div>
                        </div>
                    </div>

                    <div className="card">
                        <div className="toolbar">
                            <button onClick={() => setShowSaveModal(true)} className="btn btn-primary">
                                ðŸ’¾ Save Scenario
                            </button>
                            <button onClick={() => setShowLoadModal(true)} className="btn btn-secondary">
                                ðŸ“‚ Load Scenario ({savedScenarios.length})
                            </button>
                        </div>

                        <div className="tabs">
                            {[
                                { id: 'inputs', label: 'Input Parameters' },
                                { id: 'netWorth', label: 'Net Worth' },
                                { id: 'income', label: 'Income & Expenses' },
                                { id: 'cashFlow', label: 'Cash Flow' },
                                { id: 'compare', label: 'Compare Scenarios' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`tab ${activeTab === tab.id ? 'active' : ''}`}
                                >
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        {activeTab === 'inputs' && (
                            <div className="grid grid-3">
                                <div>
                                    <h3 className="section-title">Personal</h3>
                                    <div className="input-group">
                                        <label>Current Age</label>
                                        <input
                                            type="number"
                                            value={inputs.currentAge}
                                            onChange={(e) => updateInput('currentAge', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Retirement Age</label>
                                        <input
                                            type="number"
                                            value={inputs.retirementAge}
                                            onChange={(e) => updateInput('retirementAge', e.target.value)}
                                        />
                                    </div>
                                </div>

                                <div>
                                    <h3 className="section-title">Income</h3>
                                    <div className="input-group">
                                        <label>Current Salary ($)</label>
                                        <input
                                            type="number"
                                            value={inputs.initialSalary}
                                            onChange={(e) => updateInput('initialSalary', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Salary Growth (%)</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={inputs.salaryGrowthRate}
                                            onChange={(e) => updateInput('salaryGrowthRate', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Annual Bonus ($)</label>
                                        <input
                                            type="number"
                                            value={inputs.bonusIncome}
                                            onChange={(e) => updateInput('bonusIncome', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Other Income ($)</label>
                                        <input
                                            type="number"
                                            value={inputs.otherIncome}
                                            onChange={(e) => updateInput('otherIncome', e.target.value)}
                                        />
                                    </div>
                                </div>

                                <div>
                                    <h3 className="section-title">Tax & Expenses</h3>
                                    <div className="input-group">
                                        <label>Tax Rate (%)</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={inputs.taxRate}
                                            onChange={(e) => updateInput('taxRate', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Annual Expenses ($)</label>
                                        <input
                                            type="number"
                                            value={inputs.annualExpenses}
                                            onChange={(e) => updateInput('annualExpenses', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Expense Inflation (%)</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={inputs.expenseInflation}
                                            onChange={(e) => updateInput('expenseInflation', e.target.value)}
                                        />
                                    </div>
                                </div>

                                <div>
                                    <h3 className="section-title">Savings</h3>
                                    <div className="input-group">
                                        <label>Current Savings ($)</label>
                                        <input
                                            type="number"
                                            value={inputs.currentSavings}
                                            onChange={(e) => updateInput('currentSavings', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Savings Rate (%)</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={inputs.savingsRate}
                                            onChange={(e) => updateInput('savingsRate', e.target.value)}
                                        />
                                        <p className="help-text">% of after-tax income</p>
                                    </div>
                                    <div className="input-group">
                                        <label>Equity Allocation (%)</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={inputs.equityAllocation}
                                            onChange={(e) => updateInput('equityAllocation', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Equity Return (%)</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={inputs.equityReturn}
                                            onChange={(e) => updateInput('equityReturn', e.target.value)}
                                        />
                                    </div>
                                    <div className="input-group">
                                        <label>Property Investment Return (%)</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={inputs.propertyReturn}
                                            onChange={(e) => updateInput('propertyReturn', e.target.value)}
                                        />
                                    </div>
                                </div>

                                <div>
                                    <h3 className="section-title">Property</h3>
                                    <div className="checkbox-label">
                                        <input
                                            type="checkbox"
                                            checked={inputs.hasProperty}
                                            onChange={(e) => setInputs(prev => ({ ...prev, hasProperty: e.target.checked }))}
                                        />
                                        <label style={{ marginBottom: 0 }}>I own property</label>
                                    </div>
                                    {inputs.hasProperty && (
                                        <>
                                            <div className="input-group">
                                                <label>Property Value ($)</label>
                                                <input
                                                    type="number"
                                                    value={inputs.propertyValue}
                                                    onChange={(e) => updateInput('propertyValue', e.target.value)}
                                                />
                                            </div>
                                            <div className="input-group">
                                                <label>Mortgage Balance ($)</label>
                                                <input
                                                    type="number"
                                                    value={inputs.mortgageBalance}
                                                    onChange={(e) => updateInput('mortgageBalance', e.target.value)}
                                                />
                                            </div>
                                            <div className="input-group">
                                                <label>Mortgage Rate (%)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={inputs.mortgageRate}
                                                    onChange={(e) => updateInput('mortgageRate', e.target.value)}
                                                />
                                            </div>
                                            <div className="input-group">
                                                <label>Mortgage Term (years)</label>
                                                <input
                                                    type="number"
                                                    value={inputs.mortgageYears}
                                                    onChange={(e) => updateInput('mortgageYears', e.target.value)}
                                                />
                                            </div>
                                            <div className="input-group">
                                                <label>Property Appreciation (%)</label>
                                                <input
                                                    type="number"
                                                    step="0.1"
                                                    value={inputs.propertyAppreciation}
                                                    onChange={(e) => updateInput('propertyAppreciation', e.target.value)}
                                                />
                                            </div>
                                            <div className="input-group">
                                                <label>Rental Income ($)</label>
                                                <input
                                                    type="number"
                                                    value={inputs.rentalIncome}
                                                    onChange={(e) => updateInput('rentalIncome', e.target.value)}
                                                />
                                            </div>
                                            <div className="input-group">
                                                <label>Property Expenses ($)</label>
                                                <input
                                                    type="number"
                                                    value={inputs.propertyExpenses}
                                                    onChange={(e) => updateInput('propertyExpenses', e.target.value)}
                                                />
                                            </div>
                                        </>
                                    )}
                                </div>

                                <div>
                                    <h3 className="section-title">Retirement</h3>
                                    <div className="input-group">
                                        <label>Retirement Income ($)</label>
                                        <input
                                            type="number"
                                            value={inputs.retirementIncome}
                                            onChange={(e) => updateInput('retirementIncome', e.target.value)}
                                        />
                                        <p className="help-text">Pension, Social Security, etc.</p>
                                    </div>
                                    <div className="input-group">
                                        <label>Retirement Expense Ratio (%)</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            value={inputs.retirementExpenseMultiplier}
                                            onChange={(e) => updateInput('retirementExpenseMultiplier', e.target.value)}
                                        />
                                        <p className="help-text">% of pre-retirement expenses</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'netWorth' && (
                            <div>
                                <h3>Net Worth Projection Over 30 Years</h3>
                                <ResponsiveContainer width="100%" height={400}>
                                    <AreaChart data={projections}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis dataKey="year" />
                                        <YAxis tickFormatter={(value) => `$${(value / 1000).toFixed(0)}k`} />
                                        <Tooltip content={<CustomTooltip />} />
                                        <Legend />
                                        <Area type="monotone" dataKey="equityBalance" stackId="1" stroke="#3b82f6" fill="#3b82f6" name="Equity Portfolio" />
                                        <Area type="monotone" dataKey="propertyInvestment" stackId="1" stroke="#8b5cf6" fill="#8b5cf6" name="Property Investments" />
                                        {inputs.hasProperty && <Area type="monotone" dataKey="propertyEquity" stackId="1" stroke="#10b981" fill="#10b981" name="Property Equity" />}
                                    </AreaChart>
                                </ResponsiveContainer>
                                
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Year</th>
                                                <th>Age</th>
                                                <th>Equities</th>
                                                <th>Property Inv.</th>
                                                {inputs.hasProperty && <th>Property Equity</th>}
                                                <th>Net Worth</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {projections.filter((_, i) => i % 5 === 0).map((row) => (
                                                <tr key={row.year} className={row.age === inputs.retirementAge ? 'highlight-row' : ''}>
                                                    <td>{row.year}</td>
                                                    <td>{row.age}</td>
                                                    <td>{formatCurrency(row.equityBalance)}</td>
                                                    <td>{formatCurrency(row.propertyInvestment)}</td>
                                                    {inputs.hasProperty && <td>{formatCurrency(row.propertyEquity)}</td>}
                                                    <td style={{ fontWeight: 600 }}>{formatCurrency(row.netWorth)}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'income' && (
                            <div>
                                <h3>Income & Expenses Over Time</h3>
                                <ResponsiveContainer width="100%" height={400}>
                                    <LineChart data={projections}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis dataKey="year" />
                                        <YAxis tickFormatter={(value) => `$${(value / 1000).toFixed(0)}k`} />
                                        <Tooltip content={<CustomTooltip />} />
                                        <Legend />
                                        <Line type="monotone" dataKey="grossIncome" stroke="#10b981" strokeWidth={2} name="Gross Income" />
                                        <Line type="monotone" dataKey="afterTaxIncome" stroke="#3b82f6" strokeWidth={2} name="After-Tax Income" />
                                        <Line type="monotone" dataKey="expenses" stroke="#ef4444" strokeWidth={2} name="Total Expenses" />
                                        <Line type="monotone" dataKey="tax" stroke="#f59e0b" strokeWidth={2} name="Tax" />
                                    </LineChart>
                                </ResponsiveContainer>
                            </div>
                        )}

                        {activeTab === 'cashFlow' && (
                            <div>
                                <h3>Annual Cash Flow</h3>
                                <ResponsiveContainer width="100%" height={400}>
                                    <AreaChart data={projections}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis dataKey="year" />
                                        <YAxis tickFormatter={(value) => `$${(value / 1000).toFixed(0)}k`} />
                                        <Tooltip content={<CustomTooltip />} />
                                        <Legend />
                                        <Area type="monotone" dataKey="cashFlow" stroke="#10b981" fill="#10b981" name="Cash Flow" />
                                        <Area type="monotone" dataKey="savings" stroke="#3b82f6" fill="#3b82f6" name="Actual Savings" />
                                    </AreaChart>
                                </ResponsiveContainer>
                            </div>
                        )}

                        {activeTab === 'compare' && (
                            <div>
                                <h3>Compare Scenarios</h3>
                                <p style={{ color: '#6b7280', marginBottom: '1rem' }}>
                                    Select saved scenarios to compare against your current inputs
                                </p>
                                
                                {savedScenarios.length === 0 ? (
                                    <div style={{ padding: '2rem', textAlign: 'center', color: '#6b7280' }}>
                                        <p>No saved scenarios to compare. Save your current inputs first!</p>
                                    </div>
                                ) : (
                                    <>
                                        <div style={{ marginBottom: '1.5rem' }}>
                                            <h4 style={{ fontSize: '1rem', fontWeight: 600, marginBottom: '0.5rem' }}>
                                                Select Scenarios to Compare:
                                            </h4>
                                            <div className="grid grid-2" style={{ gap: '0.5rem' }}>
                                                {savedScenarios.map((scenario) => (
                                                    <div 
                                                        key={scenario.id}
                                                        className="checkbox-label"
                                                        style={{ 
                                                            padding: '0.5rem',
                                                            border: '1px solid #e5e7eb',
                                                            borderRadius: '6px',
                                                            background: selectedComparisons.includes(scenario.id) ? '#eff6ff' : 'white'
                                                        }}
                                                    >
                                                        <input
                                                            type="checkbox"
                                                            checked={selectedComparisons.includes(scenario.id)}
                                                            onChange={() => toggleComparison(scenario.id)}
                                                        />
                                                        <label style={{ marginBottom: 0 }}>{scenario.name}</label>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {selectedComparisons.length > 0 && (
                                            <div>
                                                <h4 style={{ fontSize: '1rem', fontWeight: 600, marginBottom: '1rem' }}>
                                                    Net Worth Comparison
                                                </h4>
                                                <ResponsiveContainer width="100%" height={400}>
                                                    <LineChart data={comparisonData}>
                                                        <CartesianGrid strokeDasharray="3 3" />
                                                        <XAxis dataKey="year" />
                                                        <YAxis tickFormatter={(value) => `$${(value / 1000).toFixed(0)}k`} />
                                                        <Tooltip content={<CustomTooltip />} />
                                                        <Legend />
                                                        {getComparisonLines()}
                                                    </LineChart>
                                                </ResponsiveContainer>

                                                <div className="table-container">
                                                    <table>
                                                        <thead>
                                                            <tr>
                                                                <th>Year</th>
                                                                <th>Current</th>
                                                                {selectedComparisons.map(id => {
                                                                    const scenario = savedScenarios.find(s => s.id === id);
                                                                    return <th key={id}>{scenario?.name}</th>;
                                                                })}
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {comparisonData.filter((_, i) => i % 5 === 0).map((row) => (
                                                                <tr key={row.year}>
                                                                    <td>{row.year}</td>
                                                                    <td style={{ fontWeight: 600 }}>{formatCurrency(row['Current'])}</td>
                                                                    {selectedComparisons.map(id => {
                                                                        const scenario = savedScenarios.find(s => s.id === id);
                                                                        return <td key={id}>{formatCurrency(row[scenario?.name] || 0)}</td>;
                                                                    })}
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        )}
                                    </>
                                )}
                            </div>
                        )}
                    </div>

                    <div className="card footer">
                        ðŸ’¡ This is a simplified model for planning purposes. Actual results will vary based on market conditions, life events, and other factors. Consider consulting a financial advisor for personalized advice.
                    </div>

                    {showSaveModal && (
                        <div className="modal-overlay" onClick={() => setShowSaveModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <h2>Save Scenario</h2>
                                <div className="input-group">
                                    <label>Scenario Name</label>
                                    <input
                                        type="text"
                                        value={scenarioName}
                                        onChange={(e) => setScenarioName(e.target.value)}
                                        placeholder="e.g., Conservative Plan, Aggressive Growth..."
                                        onKeyPress={(e) => e.key === 'Enter' && saveScenario()}
                                    />
                                </div>
                                <div className="modal-buttons">
                                    <button onClick={saveScenario} className="btn btn-primary">Save</button>
                                    <button onClick={() => setShowSaveModal(false)} className="btn btn-secondary">Cancel</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showLoadModal && (
                        <div className="modal-overlay" onClick={() => setShowLoadModal(false)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <h2>Load Scenario</h2>
                                {savedScenarios.length === 0 ? (
                                    <p style={{ color: '#6b7280', textAlign: 'center', padding: '2rem' }}>
                                        No saved scenarios yet. Save your current inputs to create one!
                                    </p>
                                ) : (
                                    <div>
                                        {savedScenarios.map((scenario) => (
                                            <div key={scenario.id} className="scenario-item">
                                                <div className="scenario-info">
                                                    <h3>{scenario.name}</h3>
                                                    <p>Saved {new Date(scenario.savedAt).toLocaleDateString()} at {new Date(scenario.savedAt).toLocaleTimeString()}</p>
                                                </div>
                                                <div className="scenario-actions">
                                                    <button 
                                                        onClick={() => loadScenario(scenario)} 
                                                        className="btn btn-primary"
                                                        style={{ padding: '0.25rem 0.75rem', fontSize: '0.75rem' }}
                                                    >
                                                        Load
                                                    </button>
                                                    <button 
                                                        onClick={() => deleteScenario(scenario.id)} 
                                                        className="btn btn-danger"
                                                        style={{ padding: '0.25rem 0.75rem', fontSize: '0.75rem' }}
                                                    >
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                <div className="modal-buttons">
                                    <button onClick={() => setShowLoadModal(false)} className="btn btn-secondary">Close</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FinancialPlanner />);
    </script>
</body>
</html>